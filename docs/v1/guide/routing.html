
<!DOCTYPE html>
<html lang="en">
    <head>

    <title>Routing — CatLib</title>
    <meta charset="utf-8">
    <meta name="description" content="CatLib Unity Framework.">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <link rel="stylesheet" href="/css/page.css">

    <script src="/js/vue.js"></script>
    <script src="/js/jquery.js"></script>
    </head>

    <body>
        
            <nav class="nav">
    <div class="border">
        <img src="/images/logo.png" />
        <button class="hiden-in-phone">V0.8</button>
        <button id="btn-menu" class="hiden-in-pc">Menu</button>
        <ul class="nav-link hiden-in-phone">
            <!--li>
                <form id="search-form">
                    <input type="text" id="search-query" class="search-query">
                </form>
            </li!-->
            <li><a href="https://github.com/catlib/catlib" class="nav-link-li">Download</a></li>
            <li><a href="/v1/guide/use.html" class="nav-link-li">Case</a></li>
            <li><a href="/v1/guide/version.html" class="nav-link-li">Release Notes</a></li>
            <li><a href="/v1/guide/contribution.html" class="nav-link-li">Contribution</a></li>
            <li><a href="/v1/guide/index.html" class="nav-link-li">About</a></li>
            <li><a href="/" class="nav-link-li current">Index</a></li>
        </ul>
    </div>
</nav>

<div id="container" class="container clear">
    <section class="sidebar clearfix">
    <ul>
        
            
            
                <li><h3>Basis</h3></li>
            
            
            
            <li>
                <p><a href="/v1/guide/index.html" class="sidebar-link">Introduction</a></p>
            </li>
        
            
            
            
            
            <li>
                <p><a href="/v1/guide/upgrade.html" class="sidebar-link">Upgrade Guide</a></p>
            </li>
        
            
            
            
            
            <li>
                <p><a href="/v1/guide/version.html" class="sidebar-link">Release Notes</a></p>
            </li>
        
            
            
            
            
            <li>
                <p><a href="/v1/guide/error.html" class="sidebar-link">Common mistakes</a></p>
            </li>
        
            
            
            
            
            <li>
                <p><a href="/v1/guide/style.html" class="sidebar-link">Code Style</a></p>
            </li>
        
            
            
            
            
            <li>
                <p><a href="/v1/guide/contribution.html" class="sidebar-link">Contribution</a></p>
            </li>
        
            
            
            
            
            <li>
                <p><a href="/v1/guide/use.html" class="sidebar-link">Use case</a></p>
            </li>
        
            
            
            
                <li><h3>System Structure</h3></li>
            
            
            <li>
                <p><a href="/v1/guide/service-provider.html" class="sidebar-link">Service provider</a></p>
            </li>
        
            
            
            
            
            <li>
                <p><a href="/v1/guide/container.html" class="sidebar-link">Container</a></p>
            </li>
        
            
            
            
            
            <li>
                <p><a href="/v1/guide/application.html" class="sidebar-link">CatLib Core</a></p>
            </li>
        
            
            
            
            
            <li>
                <p><a href="/v1/guide/api.html" class="sidebar-link">API</a></p>
            </li>
        
            
            
            
            
            <li>
                <p><a href="/v1/guide/facade.html" class="sidebar-link">Service facade</a></p>
            </li>
        
            
            
            
            
                <li><h3>Core Components</h3></li>
            
            <li>
                <p><a href="/v1/guide/config.html" class="sidebar-link">Configuration</a></p>
            </li>
        
            
            
            
            
            <li>
                <p><a href="/v1/guide/routing.html" class="sidebar-link current">Routing</a></p>
            </li>
        
            
            
            
            
            <li>
                <p><a href="/v1/guide/stl.html" class="sidebar-link">Standard library</a></p>
            </li>
        
            
            
            
            
            <li>
                <p><a href="/v1/guide/file-system.html" class="sidebar-link">File system</a></p>
            </li>
        
            
            
            
            
            <li>
                <p><a href="/v1/guide/time.html" class="sidebar-link">Time</a></p>
            </li>
        
            
            
            
            
            <li>
                <p><a href="/v1/guide/timer.html" class="sidebar-link">Timer</a></p>
            </li>
        
    </ul>
</section>
    <article class="clearfix">
    <h2 id="Routing"><a href="#Routing" class="headerlink" title="Routing"></a>Routing</h2><blockquote>
<p>This article is translated by machine</p>
</blockquote>
<p>The CatLib routing system gives you the ability to schedule a function through a uri.</p>
<h3 id="Basic-concept"><a href="#Basic-concept" class="headerlink" title="Basic concept"></a>Basic concept</h3><h4 id="Basic-composition"><a href="#Basic-composition" class="headerlink" title="Basic composition"></a><strong>Basic composition</strong></h4><p>The CatLib routing system consists of a router, a feature route, a route entry, a routing compiler, and a routing group.</p>
<p><code>Router</code> is responsible for the scheduling of the entire routing system</p>
<p><code>The routing entry</code> is the basic unit in the routing system, and she identifies the specific route and route destination.</p>
<p><code>Routing group</code> is a group scope, a routing group can have multiple routing entries, and vice versa routing entries can also have multiple routing groups.</p>
<p>The <code>attribute route</code> is an extension of the routing system that allows the developer to mark the routing method after the route object method is marked in the form of a feature.</p>
<p><code>The routing compiler</code> is used to compile the routing entries. The compiled routing entries can be used by the router.</p>
<h4 id="Glossary"><a href="#Glossary" class="headerlink" title="Glossary"></a><strong>Glossary</strong></h4><p><code>Dispatch</code> a method that calls the route by way of routing.</p>
<h3 id="Scenes-to-be-used"><a href="#Scenes-to-be-used" class="headerlink" title="Scenes to be used"></a>Scenes to be used</h3><ul>
<li>(client, server) through the URI control client switch UI, scenes and so on.</li>
<li>allow blocking the UI, the scene jump process, handle the client buried and other logic.</li>
<li>Cross-component API calls allow parameter passing and parsing, and component decoupling by controlling inversion.<br>Debug instruction control</li>
</ul>
<h3 id="Initial-configuration"><a href="#Initial-configuration" class="headerlink" title="Initial configuration"></a>Initial configuration</h3><p>The initial configuration must be configured before the framework is initialized. The following is the initial configuration required by the routing component:</p>
<table>
<thead>
<tr>
<th>Configuration name</th>
<th style="text-align:center">Must</th>
<th style="text-align:center">Configuration description (click to view details)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>routing.stripping.reserved</code></td>
<td style="text-align:center">No</td>
<td style="text-align:center"><a href="#Routing compiler stripping">Compile-time compiler compiled assembly</a></td>
</tr>
</tbody>
</table>
<h3 id="Legal-URI"><a href="#Legal-URI" class="headerlink" title="Legal URI"></a>Legal URI</h3><p>The URIs that conform to the following RFC definitions are legal URIs that can be parsed by the CatLib routing system:</p>
<ul>
<li><a href="https://www.ietf.org/rfc/rfc1808.txt" target="_blank" rel="external">RFC1808</a></li>
<li><a href="https://www.ietf.org/rfc/rfc1738.txt" target="_blank" rel="external">RFC1738</a></li>
<li><a href="https://www.ietf.org/rfc/rfc2396.txt" target="_blank" rel="external">RFC2396</a></li>
<li><a href="https://www.ietf.org/rfc/rfc2732.txt" target="_blank" rel="external">RFC2732</a></li>
</ul>
<h3 id="Basic-registration"><a href="#Basic-registration" class="headerlink" title="Basic registration"></a>Basic registration</h3><p>Registering a basic route requires only a <code>url</code> with a<code>lambda</code>, and if you do not define uri’s <code>scheme</code> then the default value will be used:</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">Router.Instance.Reg(<span class="string">"main"</span>, (request, response) =&gt;</div><div class="line">&#123;</div><div class="line">    response.SetContext(<span class="string">"hello world"</span>);</div><div class="line">&#125;);</div><div class="line">Router.Instance.Dispatch(<span class="string">"catlib://main"</span>);</div></pre></td></tr></table></figure>
<h3 id="Attribute-routing-registration"><a href="#Attribute-routing-registration" class="headerlink" title="Attribute routing registration"></a>Attribute routing registration</h3><p>CatLib also allows you to add a route tag <code>Routed</code>‘for the class. Note that the class to be routed must be marked as <code>[Routed]</code> and you need to mark <code>[Routed]</code> on the routing method, and ensure that the method Access level is <code>public</code>:</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">[<span class="meta">Routed</span>]</div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AttrRouting</span></div><div class="line">&#123;</div><div class="line">    [<span class="meta">Routed</span>]</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Call</span>(<span class="params">IRequest request, IResponse response</span>)</span></div><div class="line">    &#123;</div><div class="line">        res.SetContext(<span class="string">"hello world"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">Router.Instance.Dispatch(<span class="string">"catlib://attr-routing/call"</span>);</div></pre></td></tr></table></figure>
<h3 id="Required-routing-parameters"><a href="#Required-routing-parameters" class="headerlink" title="Required routing parameters"></a>Required routing parameters</h3><p>Sometimes we need to catch some fragments of the <code>url</code>‘in the route. For example, if we need to capture from the url to access the props detailed interface <code>props id</code>, we can define the routing parameters:</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">Router.Instance.Reg(<span class="string">"props-detail/&#123;id&#125;"</span>, (request, response) =&gt;</div><div class="line">&#123;</div><div class="line">    response.SetContext(<span class="string">"props id:"</span> + request[<span class="string">"id"</span>]);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>You can also define multiple parameters as needed:</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">Router.Instance.Reg(<span class="string">"bag/&#123;type&#125;/&#123;sub_type&#125;"</span>, (request, response) =&gt;</div><div class="line">&#123;</div><div class="line">    response.SetContext(<span class="string">"bag type:"</span> + request[<span class="string">"type"</span>] + <span class="string">" , sub type:"</span> + request[<span class="string">"sub_type"</span>]);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>The routing parameters are usually placed in <code>{}</code>, and the parameter name can only be: <code>a-z</code>,<code>A-Z</code>, <code>0-9</code>, and <code>_</code>.</p>
<blockquote>
<p>Note that the routing parameter can not contain the <code>-</code> character. Please use <code>_</code> to replace.</p>
</blockquote>
<h3 id="Optional-routing-parameters"><a href="#Optional-routing-parameters" class="headerlink" title="Optional routing parameters"></a>Optional routing parameters</h3><p>You can also specify that the routing parameter is an optional parameter. If you need to specify an argument as an optional parameter, you can add the <code>?</code> to the end of the parameter.</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">Router.Instance.Reg(<span class="string">"character/&#123;tag?&#125;"</span>, (request, response) =&gt;</div><div class="line">&#123;</div><div class="line">    response.SetContext(<span class="string">"tag:"</span> + request[<span class="string">"tag"</span>]);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>If <code>tag</code> does not match the appropriate parameter, the default value will be used.</p>
<h3 id="Routing-dispatcher"><a href="#Routing-dispatcher" class="headerlink" title="Routing dispatcher"></a>Routing dispatcher</h3><p>If you want to call a registered route, you can use the <code>Dispatch ()</code> method. Method to accept a <code>uri</code> and<code>context</code></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">IResponse response = Router.Instance.Dispatch(<span class="string">"character/10"</span> , <span class="string">"hello world"</span>);</div></pre></td></tr></table></figure>
<h3 id="Parameter-regular-constraint"><a href="#Parameter-regular-constraint" class="headerlink" title="Parameter regular constraint"></a>Parameter regular constraint</h3><p>You can use <code>Where()</code> to constrain the format of your routing parameters. The <code>where()</code> method accepts regular expressions for parameter names and defined parameter constraints.</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">Router.Instance.Reg(<span class="string">"character/&#123;tag?&#125;"</span>, (request, response) =&gt;</div><div class="line">&#123;</div><div class="line">    response.SetContext(<span class="string">"tag:"</span> + request[<span class="string">"tag"</span>]);</div><div class="line">&#125;).Where(<span class="string">"tag"</span>, <span class="string">"[0-9]+"</span>);</div></pre></td></tr></table></figure>
<h3 id="Parameter-default-value"><a href="#Parameter-default-value" class="headerlink" title="Parameter default value"></a>Parameter default value</h3><p>If you define an optional route, then when we do not match the corresponding parameters, we often need a default value. You can use the <code>Defaults()</code> method to set a default value for a parameter.</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">Router.Instance.Reg(<span class="string">"character/&#123;tag?&#125;"</span>, (request, response) =&gt;</div><div class="line">&#123;</div><div class="line">    response.SetContext(<span class="string">"tag:"</span> + request[<span class="string">"tag"</span>]);</div><div class="line">&#125;).Default(<span class="string">"tag"</span>, <span class="string">"1"</span>);</div></pre></td></tr></table></figure>
<h3 id="Routing-group"><a href="#Routing-group" class="headerlink" title="Routing group"></a>Routing group</h3><p>The routing group allows you to share the characteristics of the route. The features that can be shared are: parameter defaults, parameter regular constraints, processing middleware, and route exception middleware.</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">Router.Instance.Group(()=&gt;</div><div class="line">&#123;</div><div class="line">    Router.Instance.Reg(<span class="string">"character/&#123;type?&#125;"</span>, (request, response) =&gt;</div><div class="line">    &#123;</div><div class="line">        response.SetContext(<span class="string">"type:"</span> + request[<span class="string">"type"</span>]);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    Router.Instance.Reg(<span class="string">"bag/&#123;type?&#125;"</span>, (request, response) =&gt;</div><div class="line">    &#123;</div><div class="line">        response.SetContext(<span class="string">"type:"</span> + request[<span class="string">"type"</span>]);</div><div class="line">    &#125;);</div><div class="line">&#125;).Where(<span class="string">"type"</span> , <span class="string">"[0-9]+"</span>);</div></pre></td></tr></table></figure>
<h3 id="Associate-multiple-routing-groups"><a href="#Associate-multiple-routing-groups" class="headerlink" title="Associate multiple routing groups"></a>Associate multiple routing groups</h3><p>A routing entry can be associated with multiple routing groups, which can be set by the name of a given routing group.</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">IGroup group1 = Router.Instance.Group(<span class="string">"group1"</span>);</div><div class="line">group1.Where(<span class="string">"type"</span> , <span class="string">"[0-9]+"</span>);</div><div class="line"></div><div class="line">IGroup group2 = Router.Instance.Group(<span class="string">"group2"</span>);</div><div class="line">group1.Where(<span class="string">"page"</span> , <span class="string">"[0-9]+"</span>);</div><div class="line"></div><div class="line">Router.Instance.Reg(<span class="string">"character/&#123;type?&#125;"</span>, (request, response) =&gt;</div><div class="line">&#123;</div><div class="line">    response.SetContext(<span class="string">"type:"</span> + request[<span class="string">"type"</span>]);</div><div class="line">&#125;).Group(<span class="string">"group1"</span>).Group(<span class="string">"group2"</span>);</div></pre></td></tr></table></figure>
<blockquote>
<p>Note that in general we do not recommend associating multiple routing groups, which can cause the problem to become more complicated. If you need to use, please plan ahead.</p>
</blockquote>
<h3 id="Master-compilation-process"><a href="#Master-compilation-process" class="headerlink" title="Master compilation process"></a>Master compilation process</h3><p>Get a valid routing entry that can be used, CatLib has done a lot of work inside. Routing entries are usually compiled twice, compiled as follows:</p>
<p><code>Attribute routing compilation</code> =&gt; <code>entry attribute compilation</code></p>
<p>The attribute routing compilation takes place when the framework starts, and the entry feature compiles until it is compiled with the route entry.</p>
<h3 id="Attribute-routing-compilation-process"><a href="#Attribute-routing-compilation-process" class="headerlink" title="Attribute routing compilation process"></a>Attribute routing compilation process</h3><p>The CatLib Routing Compiler scans the classes marked by the feature when the framework starts and parses it into the corresponding routing entries (during the compilation process, the parameters are not overwritten). The execution flow is as follows:</p>
<ul>
<li><code>Scan all sorted routes</code><ul>
<li><code>A method of resolving all marked routes in a class</code><ul>
<li><code>Compile method Where constraint</code></li>
<li><code>Compile method Defaults default value</code></li>
<li><code>Compilation method group</code></li>
</ul>
</li>
<li><code>Compile class Where constraint</code></li>
<li><code>Compile class Defaults constraint</code></li>
<li><code>Compile class Group</code></li>
</ul>
</li>
</ul>
<h3 id="Feature-routing-configuration"><a href="#Feature-routing-configuration" class="headerlink" title="Feature routing configuration"></a>Feature routing configuration</h3><p>If you use feature routing, you can do this if you want to express the characteristics of the route in the feature route:</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">[<span class="meta">Routed(Defaults=<span class="meta-string">"type=&gt;1,tag=&gt;2"</span>,Where=<span class="meta-string">"type=&gt;[0-9]+,tag=&gt;[0-9]+"</span>)</span>]</div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AttrRouting</span></div><div class="line">&#123;</div><div class="line">    [<span class="meta">Routed(Defaults=<span class="meta-string">"type=&gt;0"</span>)</span>]</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Call</span>(<span class="params">IRequest request, IResponse response</span>)</span></div><div class="line">    &#123;</div><div class="line">        res.SetContext(<span class="string">"hello world"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    [<span class="meta">Routed</span>]</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Func</span>(<span class="params">IRequest request, IResponse response</span>)</span></div><div class="line">    &#123;</div><div class="line">        res.SetContext(<span class="string">"hello world"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The configuration of the feature route is distinguished using <code>=&gt;</code> and <code>,</code>. <code>Parameter 1 =&gt; parameter 1 value, parameter 2 =&gt; parameter 2 value</code>.</p>
<p>In this example, we define two default values for all the feature routes under <code>AttrRouting</code> ‘class:<code>type</code> and <code>tag</code>, which are<code>1</code> and <code>2</code>, respectively. Also defines the parameter regular constraints.</p>
<p>In the method <code>Call</code> we define the method’s routing default value<code>type</code>. According to <code>attribute routing compilation process</code> so the default value of the default will be <code>0</code>.</p>
<h3 id="Feature-routing-scheme"><a href="#Feature-routing-scheme" class="headerlink" title="Feature routing scheme"></a>Feature routing scheme</h3><p>Feature routing can define Scheme by giving an absolute address</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">[<span class="meta">Routed(<span class="meta-string">"ui://main"</span>)</span>]</div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AttrRouting</span></div><div class="line">&#123;</div><div class="line">    [<span class="meta">Routed(<span class="meta-string">"call"</span>)</span>]</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Call</span>(<span class="params">IRequest request, IResponse response</span>)</span></div><div class="line">    &#123;</div><div class="line">        res.SetContext(<span class="string">"hello world"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    [<span class="meta">Routed(<span class="meta-string">"ui2://func"</span>)</span>]</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Func</span>(<span class="params">IRequest request, IResponse response</span>)</span></div><div class="line">    &#123;</div><div class="line">        res.SetContext(<span class="string">"hello world"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">Router.Instance.Dispatch(<span class="string">"ui://main/call"</span>);</div><div class="line">Router.Instance.Dispatch(<span class="string">"ui2://func"</span>);</div></pre></td></tr></table></figure>
<p>The above code defines the attribute route in the form of an absolute address so that the default <code>Scheme</code> will not be used at compile time.</p>
<h3 id="What-is-routing-middleware"><a href="#What-is-routing-middleware" class="headerlink" title="What is routing middleware"></a>What is routing middleware</h3><p>Routing middleware allows interception, modification of routing requests and responses, and middleware will be executed in order.</p>
<p>Routing middleware on the macro side is divided into: <code>global middleware</code>, <code>middleware</code>, <code>routing entry middleware</code>, middleware implementation process is:</p>
<p>(Dispatching entry) <code>global middleware</code> =&gt; <code>class middleware</code> =&gt; <code>routing entry middleware</code> =&gt; <code>target routing method</code><br>(Dispatching exit) <code>global middleware</code> &lt;= <code>class middleware</code> &lt;= <code>routing entry middleware</code> &lt;= <code>target routing method</code></p>
<blockquote>
<p>Global middleware, middleware, and routing entries Middleware are different filter chain pools so their `priority ‘does not have an impact.</p>
</blockquote>
<h3 id="Routing-entry-middleware"><a href="#Routing-entry-middleware" class="headerlink" title="Routing entry middleware"></a>Routing entry middleware</h3><p>The routing entry middleware belongs to the filter chain pool of the routing entry middleware.</p>
<p>The routing entry middleware can set the middleware for the current routing entry, which can specify the specific route to execute the specified middleware.</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">Router.Instance.Reg(<span class="string">"character/&#123;type?&#125;"</span>, (request, response) =&gt;</div><div class="line">&#123;</div><div class="line">    response.SetContext(<span class="string">"type:"</span> + request[<span class="string">"type"</span>]);</div><div class="line">&#125;).Middleware((request,response,next)=&gt;</div><div class="line">&#123;</div><div class="line">    <span class="comment">// Middleware logic before routing execution</span></div><div class="line">    <span class="keyword">var</span> result = next(request,response);</div><div class="line">    <span class="comment">// Middleware logic after the route is executed</span></div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="Routing-group-middleware"><a href="#Routing-group-middleware" class="headerlink" title="Routing group middleware"></a>Routing group middleware</h3><p>The routing group middleware belongs to the filter chain pool of the routing entry middleware.</p>
<p>The routing group middleware will take effect on routes within all groups.</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">Router.Instance.Group(()=&gt;</div><div class="line">&#123;</div><div class="line">  <span class="comment">// Register the routing entry  </span></div><div class="line">&#125;).Middleware((request,response,next)=&gt;</div><div class="line">&#123;</div><div class="line">    <span class="comment">// Middleware logic</span></div><div class="line">    <span class="keyword">return</span> next(request,response);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="Class-Middleware"><a href="#Class-Middleware" class="headerlink" title="Class Middleware"></a>Class Middleware</h3><p>Class middleware belongs to the <code>class middleware</code> ‘filter chain pool.</p>
<p>By way of feature routing and class registration, you will be allowed to set the class middleware interface: <code>IMiddleware</code></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">[<span class="meta">Routed</span>]</div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AttrRouting</span> : <span class="title">IMiddleware</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> IFilterChain&lt;IRequest, IResponse&gt; Middleware </div><div class="line">    &#123;</div><div class="line">        <span class="keyword">get</span></div><div class="line">        &#123;</div><div class="line">            <span class="comment">// Filter chain</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    [<span class="meta">Routed</span>]</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Call</span>(<span class="params">IRequest request, IResponse response</span>)</span></div><div class="line">    &#123;</div><div class="line">        res.SetContext(<span class="string">"hello world"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>If the middleware interface is set in your routing tag class, the middleware will be set when scheduling the routing method under the current class.</p>
<h3 id="Global-middleware"><a href="#Global-middleware" class="headerlink" title="Global middleware"></a>Global middleware</h3><p>The global middleware belongs to the filter chain pool of <code>global middleware</code>.</p>
<p>The global middleware handles all scheduled routing entries.</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">Router.Instance.Middleware((request,response,next)=&gt;</div><div class="line">&#123;</div><div class="line">    <span class="comment">// Middleware logic</span></div><div class="line">    <span class="keyword">return</span> next(request,response);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="Can-not-find-route-entry"><a href="#Can-not-find-route-entry" class="headerlink" title="Can not find route entry"></a>Can not find route entry</h3><p>The CatLib routing system allows you to use middleware to handle <code>NotFoundRouteException</code> (you can not find a route entry that can be used).</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">Router.Instance.OnNotFound((request , next)=&gt;</div><div class="line">&#123;</div><div class="line">    <span class="comment">// Logical processing</span></div><div class="line">    <span class="keyword">return</span> next(request);</div><div class="line">&#125;,<span class="number">100</span>);</div></pre></td></tr></table></figure>
<p>You can pass a `priority ‘to determine which processing scheme is executed first, which is useful when terminating bubbling.</p>
<h3 id="Exception-handling"><a href="#Exception-handling" class="headerlink" title="Exception handling"></a>Exception handling</h3><p>In the implementation of the target method, may lead to some exceptions, so we need to deal with exception.</p>
<p>CatLib routing exception handling system in the event of an exception will be bubbling to deal with exception handling chain, exception handling is divided into: <code>global exception handling</code> and <code>local exception handling</code>, as with middleware, their filter chain pool is different.</p>
<p>Exception handling always starts locally, and CatLib’s exception handler calls the exception handler in turn, bubbling (if the bubble is terminated, then the exception is thrown).</p>
<p><code>Trigger exception</code> =&gt; <code>local exception handling</code> =&gt; <code>global exception handling</code> =&gt; <code>Dispatch() throws exception</code></p>
<blockquote>
<p>Please note the exception handling of <code>recursive route scheduling</code>.</p>
</blockquote>
<h4 id="Routine-handling-of-routing-entries"><a href="#Routine-handling-of-routing-entries" class="headerlink" title="Routine handling of routing entries"></a><strong>Routine handling of routing entries</strong></h4><p>The exception handling of the routing entry belongs to <code>local exception handling</code>.</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">Router.Instance.Reg(<span class="string">"character/&#123;type?&#125;"</span>, (request, response) =&gt;</div><div class="line">&#123;</div><div class="line">    response.SetContext(<span class="string">"type:"</span> + request[<span class="string">"type"</span>]);</div><div class="line">&#125;).OnError((request,response,ex,next) =&gt;</div><div class="line">&#123;</div><div class="line">    <span class="comment">// Before other exception handling classes are executed</span></div><div class="line">    <span class="keyword">var</span> result = next(request,response,ex);</div><div class="line">    <span class="comment">// After other exception handling classes are executed</span></div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="Routing-group-exception-handling"><a href="#Routing-group-exception-handling" class="headerlink" title="Routing group exception handling"></a><strong>Routing group exception handling</strong></h4><p>The exception handling of the routing entry belongs to <code>local exception handling</code>.</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">Router.Instance.Group(()=&gt;</div><div class="line">&#123;</div><div class="line">  <span class="comment">// Register the routing entry  </span></div><div class="line">&#125;).OnError((request,response,ex,next) =&gt;</div><div class="line">&#123;</div><div class="line">    <span class="comment">// Before other exception handling classes are executed</span></div><div class="line">    <span class="keyword">var</span> result = next(request,response,ex);</div><div class="line">    <span class="comment">// After other exception handling classes are executed</span></div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="Global-exception-handling"><a href="#Global-exception-handling" class="headerlink" title="Global exception handling"></a><strong>Global exception handling</strong></h4><p>The exception handling of the routing entry belongs to the <code>global exception handling</code>.</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">Router.Instance.OnError((request,response,ex,next) =&gt;</div><div class="line">&#123;</div><div class="line">    <span class="comment">// Before other exception handling classes are executed</span></div><div class="line">    <span class="keyword">var</span> result = next(request,response,ex);</div><div class="line">    <span class="comment">// After other exception handling classes are executed</span></div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="Recursive-routing-scheduling"><a href="#Recursive-routing-scheduling" class="headerlink" title="Recursive routing scheduling"></a>Recursive routing scheduling</h3><p>CatLib routing system has been a good recursive call to support, you can safely recursive call.</p>
<h4 id="The-process-of-exception-handling-when-recursive-routing"><a href="#The-process-of-exception-handling-when-recursive-routing" class="headerlink" title="The process of exception handling when recursive routing"></a><strong>The process of exception handling when recursive routing</strong></h4><p>Assuming we have made a recursive call, the exception will be triggered by the following process:</p>
<p><code>Trigger Exception</code> =&gt; <code>Local Exception Handling (Nested Dispatch (&quot;ui://call2&quot;))</code> =&gt; <code>Global Exception Handling</code> =&gt; <code>Local Exception Handling (ui://call)</code> =&gt; <code>Global Exception Handling</code> =&gt; <code>Dispatch () throws an exception</code></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">Router.Instance.Reg(<span class="string">"ui://call"</span> , (request,response)=&gt;</div><div class="line">&#123;</div><div class="line">    Router.Instance.Dispatch(<span class="string">"ui://call2"</span>);</div><div class="line">&#125;);</div><div class="line">Router.Instance.Reg(<span class="string">"ui://call2"</span> , (request,response)=&gt;</div><div class="line">&#123;</div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"ex"</span>);</div><div class="line">&#125;);</div><div class="line">Router.Instance.Dispatch(<span class="string">"ui://call"</span>);</div></pre></td></tr></table></figure>
<h3 id="Modify-the-default-Scheme"><a href="#Modify-the-default-Scheme" class="headerlink" title="Modify the default Scheme"></a>Modify the default Scheme</h3><p>The default scheme for the CatLib routing system is <code>catlib</code>. But you can modify the default Scheme by <code>SetDefaultScheme ()</code>.</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">Router.Instance.SetDefaultScheme(<span class="string">"home"</span>);</div></pre></td></tr></table></figure>
<h3 id="Route-compilation-stripping"><a href="#Route-compilation-stripping" class="headerlink" title="Route compilation stripping"></a>Route compilation stripping</h3><p>The CatLib routing system strips off unwanted scans when compiling.</p>
<p>The following assembly will not be stripped at compile time:</p>
<ul>
<li>Assembly-CSharp</li>
<li>Assembly-CSharp-Editor-firstpass</li>
<li>Assembly-CSharp-Editor</li>
<li>CatLib</li>
<li>CatLib.Tests</li>
</ul>
<p>You can do this by configuring: <code>routing.stripping.reserved</code> to fill in an assembly that is not to be stripped , Use <code>;</code> to separate assemblies.</p>
<h3 id="Routing-is-automatically-named"><a href="#Routing-is-automatically-named" class="headerlink" title="Routing is automatically named"></a>Routing is automatically named</h3><p>When you use a feature route, if you do not have a given route <code>uri</code> then you will use the route automatic naming mechanism.</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">[<span class="meta">Routed</span>]</div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AttrRouting</span></div><div class="line">&#123;</div><div class="line">    [<span class="meta">Routed</span>]</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Call</span>(<span class="params"></span>)</span></div><div class="line">    &#123;</div><div class="line">        res.SetContext(<span class="string">"hello world"</span>);</div><div class="line">    &#125;</div><div class="line">    [<span class="meta">Routed</span>]</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CallNPC</span>(<span class="params"></span>)</span></div><div class="line">    &#123;</div><div class="line">        res.SetContext(<span class="string">"hello world"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Automatic naming rules are: according to class name or function name to all lower case, between the words with <code>-</code>for the segmentation of the string, continuous capitalization as a word.</p>
<p>The above route will be converted to: <code>catlib://attr-routing/call</code> and <code>catlib://attr-routing/call-npc</code>.</p>
<h3 id="Automatic-route-injection"><a href="#Automatic-route-injection" class="headerlink" title="Automatic route injection"></a>Automatic route injection</h3><p>When you use feature routing, you can use automatic parameter injection to get the required parameters. The CatLib container automatically parses and injects the demand parameters.</p>
<p>Where the <code>IRequest</code> and<code>IResponse</code> types are requests and responses for the current route.</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">[<span class="meta">Routed</span>]</div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AttrRouting</span></div><div class="line">&#123;</div><div class="line">    [<span class="meta">Routed</span>]</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Call</span>(<span class="params">IRequest request, IResponse response</span>)</span></div><div class="line">    &#123;</div><div class="line">        res.SetContext(<span class="string">"hello world"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    [<span class="meta">Routed</span>]</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Call2</span>(<span class="params">IResponse response, IApplication App , IRouter router</span>)</span></div><div class="line">    &#123;</div><div class="line">        res.SetContext(<span class="string">"hello world"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Performance-optimization"><a href="#Performance-optimization" class="headerlink" title="Performance optimization"></a>Performance optimization</h3><p>The CatLib routing system is a complex system that you should not use in high performance requirements or frequently called.</p>
<p>We have given the following optimization options:</p>
<ul>
<li>Define different schemes for different types of routing destinations</li>
<li>Reduce the complexity of constraints</li>
<li>Use manually registered routes</li>
</ul>

    <div class="footer">
        found mistake? Want to participate in editing?
        <a href="https://github.com/catlib/catlib.github.io/blob/master/src/v1/guide/routing.md" target="_blank">
            Edit this page on Github!
        </a>
    </div>
</article>

<div class="sub-nav hiden-in-phone">
    <dl id="sub-nav">
        <dt>Content</dt>
        <dd v-for="(ele, index) in sub_nav">
           <a v-bind:href="ele.href">{{ ele.name }}</a>
        </dd>
    </dl>
</div> 
</div>

<footer>
    <div>
        <p>© Copyright 2017 catlib.io All Rights Reserved</p>
        <p>Meow meow, come and play meow ~</p>
    </div>
</footer>


<script>
var vm = new Vue({
    el : '#container',
    data: {
        sub_nav : [ ]
    },
    created:function(){
        var obj = [];
        $("article h3").each(function(){
            obj.push({name :  $(this).find("a").attr("title") , href : "#"+$(this).attr("id") });
        });

        this.sub_nav = obj;       
    }
});

var isShow = false;
$("nav").on("click","#btn-menu" , function(){

    if(!isShow){
        
        if($(document).scrollTop() > $(".sidebar").height() - 100){

            $('html, body').animate({scrollTop:0} , 300, "swing",function(){

                $(".sidebar").fadeIn();
                $(".container").animate({"left" : "15rem"}, 500,"swing");
            });
        }else{

                $(".sidebar").fadeIn();
                $(".container").animate({"left" : "15rem"}, 500,"swing");

        }

    }else{
        $(".sidebar").fadeOut();
        $(".container").animate({"left" : "0rem"}, 500,"swing");
    }
    isShow = !isShow;

});

$(".container").on("click" , "article" , function(){

    if(isShow){
        $(".sidebar").fadeOut();
        $(".container").animate({"left" : "0rem"}, 500,"swing");
        isShow = false;    
    }

});
</script>
        
    </body>
</html>